function ChaZD(t,o,i,a){this.wordSource=i;var e=((this.useHttps=o)?urls.dictHttps:urls.dict)+t,n=this,s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){if(4==s.readyState){var e=JSON.parse(s.responseText);if(-1===t.indexOf("-")||n.checkErrorCode(e.errorCode).error||n.haveTranslation(e)){var r=n.parseResult.call(n,e);a(r)}else new ChaZD(t.replace(/-/g," "),o,i,a)}},s.send()}function preprocessWord(e){return-1===e.indexOf(" ")&&(e=e.replace(/_/g," "),/[a-z]+/.test(e)&&(e=trim(e.replace(/([A-Z])/g," $1")))),e}function showNotification(e){if(Notifications){var r=null;return 0===Notifications.checkPermission()?((r=Notifications.createNotification(e.icon||chrome.extension.getURL("icons/icon128.png"),e.title||"ChaZD 查字典",e.content)).onclick=function(){window.open("https://chrome.google.com/webstore/detail/chazd/nkiipedegbhbjmajlhpegcpcaacbfggp")},r.show()):Notifications.requestPermission(),r}}ChaZD.prototype.checkErrorCode=function(e){var r={message:"",error:0,errorCode:0};switch(e){case 0:r.message="query success";break;case 20:r.message="要翻译的文本过长",r.error=1,r.errorCode=20;break;case 30:r.message="无法进行有效的翻译",r.error=1,r.errorCode=30;break;case 40:r.message="不支持的语言类型",r.error=1,r.errorCode=40;break;case 50:r.message="无效的key",r.error=1,r.errorCode=50;break;case 60:r.message="无辞典结果",r.error=1,r.errorCode=60}return r},ChaZD.prototype.parseResult=function(e){var r={},t=this.checkErrorCode(e.errorCode);if(r.haveWebTranslation=!1,t.error)r.errorCode=t.errorCode;else{var o=this.initTitle(e);if(r.titleBlock=o.titleBlock,r.haveTranslation=this.haveTranslation(e),void 0!==e.basic){var i=this.parseBasicResult(e);r.basicBlock=i}if(void 0!==e.web){var a=this.parseWebResult(e);r.haveWebTranslation=!0,r.webBlock=a}}return r.validMessage=t.message,r},ChaZD.prototype.haveTranslation=function(e){if(this.checkErrorCode(e.errorCode).error)return!1;var r=e.translation,t=e.query;return trim(t.toLowerCase())!==trim(r.toString().toLowerCase())},ChaZD.prototype.initTitle=function(e){var r=e.translation,t=e.query,o=this.initVoice(t);t=50<=t.length&&"select"==this.wordSource?this.shortWord(t):t;var i=fmt(frame.titleWord,t,o),a=fmt(frame.titleTranslation,r.toString());return{titleBlock:fmt(frame.titleContainer,i,a,50<=t.length?"long-text":"")}},ChaZD.prototype.shortWord=function(e){return e.slice(0,e.lastIndexOf(" ",50)).concat(" ...")},ChaZD.prototype.parseBasicResult=function(e){var r=e.basic,t=e.query,o=this.parseBasicPhonetic(r,t),i=this.parseBasicExplains(r,t);return fmt(frame.basicContainer,o,i)},ChaZD.prototype.parseBasicPhonetic=function(e,r){var t=e["uk-phonetic"],o=e["us-phonetic"];if(void 0===t||void 0===o)return fmt(frame.phoneticContainer,"","");var i=this.initVoice(r,1),a=fmt(frame.ukPhoneticContainer,"["+t+"]"+i),n=this.initVoice(r,2),s=fmt(frame.usPhoneticContainer,"["+o+"]"+n);return fmt(frame.phoneticContainer,a,s)},ChaZD.prototype.initVoice=function(e,r){var t=(this.useHttps?urls.voiceHttps:urls.voice)+e;void 0!==r&&(t=t+"&type="+r);var o="";return o=1===r?"英音":2===r?"美音":"真人发音",fmt(frame.voiceContainer,t,o)},ChaZD.prototype.parseBasicExplains=function(e,r){var t,o=e.explains,i="";for(t=0;t<o.length;t++){var a=o[t],n=a.indexOf(". "),s=-1!==n?a.slice(0,n+1):"",c=this.parseProperty(s),h=fmt(frame.propertyContainer,c,s),p=-1!==n?a.slice(n+1):a;i+=fmt(frame.explain,h,p)}return fmt(frame.explainsContainer,fmt(frame.explainsList,i))},ChaZD.prototype.parseProperty=function(e){var r="";switch(e){case"adj.":r="形容词";break;case"adv.":r="副词";break;case"n.":r="名词";break;case"vi.":r="不及物动词";break;case"vt.":r="及物动词";break;case"prep.":r="介词";break;case"conj.":r="连词";break;case"int.":r="感叹词";break;case"abbr.":r="代词";break;case"pron.":r=""}return r},ChaZD.prototype.parseWebResult=function(e){var r,t=e.web,o="";for(r=0;r<t.length;r++){o+=fmt(frame.webExplain,t[r].key,t[r].value)}return fmt(frame.webExplainsContainer,fmt(frame.webExplainsList,o))},window.Notifications=window.Notifications||window.webkitNotifications,chrome.runtime.onInstalled.addListener(function(e){"install"===e.reason?showNotification({title:"感谢支持 ChaZD ！",content:"ChaZD 力求成为最简洁易用的 Chrome 词典扩展，欢迎提出您的意见或建议。如果觉得 ChaZD 还不错，记得给5星好评哦:)"}):"update"===e.reason&&(chrome.storage.sync.set({showTips:!0},function(){}),showNotification({title:"ChaZD 更新到0.8.19版！",content:"修复若干 bug，如出现无法查词的问题，请在设置中关闭使用 HTTPS 接口"}))}),chrome.storage.sync.get(null,function(e){if(void 0===e.showTips)chrome.storage.sync.set(settings);else{for(var r in e)void 0===settings[r]?chrome.storage.sync.remove(r):settings[r]=e[r];chrome.storage.sync.set(settings)}}),chrome.runtime.onMessage.addListener(function(e,r,t){return new ChaZD(preprocessWord(e.queryWord),e.useHttps,e.source,t),!0});