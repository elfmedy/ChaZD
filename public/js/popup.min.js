var $button=document.querySelector("#search"),$input=document.querySelector("#query-word"),$queryResultContainer=document.querySelector("#query-result");function queryInPopup(e){$queryResultContainer.classList.contains("unshow")&&$queryResultContainer.classList.remove("unshow"),""!==$input.value&&($queryResultContainer.innerHTML="ψ(._. )>词典君正在翻译。。。"),e?($input.value=e,chrome.extension.sendMessage({queryWord:e,source:"popup",useHttps:useHttpsValue},buildResult)):chrome.extension.sendMessage({queryWord:$input.value,source:"popup",useHttps:useHttpsValue},buildResult)}-1!==window.navigator.platform.toLowerCase().indexOf("mac")&&(document.querySelector("#ctrl-option").firstChild.nodeValue="Command");var buildResult=function(e){var t=e,i="";if("query success"==t.validMessage){i+=t.titleBlock,void 0!==t.basicBlock&&(i+=t.basicBlock),void 0!==t.webBlock&&(i+=t.webBlock),$queryResultContainer.innerHTML=i;var s,n,o=document.querySelectorAll(".voice-container");for(s=0,n=o.length;s<n;s++)buildVoice(o[s])}else 20==t.errorCode?$queryResultContainer.innerHTML="<p>这段文字太长，词典君无能为力了（┬_┬） <br><br>试试短一点的吧~</p>":40==t.errorCode?$queryResultContainer.innerHTML="<p>对不起，这段文字太高深了，请饶过词典君吧（┬_┬）</p>":1e3==t.errorCode?$queryResultContainer.innerHTML="<p>JSON解析错误，可能同一时间请求过多</p>":$queryResultContainer.innerHTML="<p>词典君罢工啦（┬_┬）<br><br> 是不是网络不太好？<br><br> 稍后再试一次吧</p>"};function buildVoice(e){var t=e.getAttribute("data-src"),i=document.createElement("audio");i.setAttribute("src",t),e.appendChild(i),i.addEventListener("ended",function(e){this.load()}),e.addEventListener("click",function(e){i.play()})}function createLink(e,t){e.addEventListener("click",function(e){chrome.tabs.create({url:t})})}$button.addEventListener("click",function(e){}),$input.select(),$input.addEventListener("input",function(e){var t=$input.value;setTimeout(function(){$input.value===t&&""!==$input.value&&queryInPopup()},500)});var issue=document.querySelector("#issue"),email=document.querySelector("#email"),source=document.querySelector("#source"),keySet=document.querySelector("#key-set"),score=document.querySelector("#score");function totalHeight(e){for(var t=document.getElementsByClassName(e),i=t.length,s=0,n=0;n<i;n++)s+=t[n].scrollHeight;return s+10}createLink(email,"mailto:ververcpp@gmail.com"),createLink(source,"https://github.com/ververcpp/ChaZD"),createLink(issue,"https://github.com/ververcpp/ChaZD/issues/new"),createLink(keySet,"chrome://extensions/configureCommands"),createLink(score,"https://chrome.google.com/webstore/detail/chazd/nkiipedegbhbjmajlhpegcpcaacbfggp"),document.querySelector("#setting-button").addEventListener("click",function(e){var t=document.getElementById("settings");t.classList.toggle("active"),t.classList.contains("active")?t.style.height=blockHeight+"px":t.style.height=0});var blockHeight=totalHeight("top-menu")+totalHeight("sub-menu")+totalHeight("carved")+32+12,linkQuery=document.querySelector("#linkQuery"),noSelect=document.querySelector("#noSelect"),mouseSelect=document.querySelector("#mouseSelect"),useCtrl=document.querySelector("#useCtrl"),autoAudio=document.querySelector("#autoAudio"),defaultUk=document.querySelector("#defaultUk"),defaultUs=document.querySelector("#defaultUs"),showPositionSide=document.querySelector("#showPositionSide"),showPositionNear=document.querySelector("#showPositionNear"),autoHide=document.querySelector("#autoHide"),showDuration=document.querySelector("#showDuration"),currentDuration=document.querySelector("#currentDuration"),tips=document.querySelector("#tips"),toggleKey=document.querySelector("#toggle-key"),useHttps=document.querySelector("#useHttps"),isShowTips=document.querySelector("#isShowTips"),useHttpsValue=!1;chrome.storage.sync.get(null,function(e){""!==e.currentWord&&queryInPopup(e.currentWord),!0===e.linkQuery?(linkQuery.checked=!0,linkQuery.nextSibling.classList.remove("unactive")):(linkQuery.checked=!1,linkQuery.nextSibling.classList.add("unactive")),!0===e.useHttps?(useHttps.checked=!0,useHttpsValue=!0,useHttps.nextSibling.classList.remove("unactive")):(useHttps.checked=!1,useHttpsValue=!1,useHttps.nextSibling.classList.add("unactive")),!0===e.autoAudio?(autoAudio.checked=!0,autoAudio.nextSibling.classList.remove("unactive")):(autoAudio.checked=!1,autoAudio.nextSibling.classList.add("unactive")),1===e.defaultVoice?(defaultUk.checked=!0,defaultUk.nextSibling.classList.remove("unactive"),defaultUs.nextSibling.classList.add("unactive")):2===e.defaultVoice&&(defaultUs.checked=!0,defaultUs.nextSibling.classList.remove("unactive"),defaultUk.nextSibling.classList.add("unactive")),"noSelect"===e.selectMode&&(noSelect.checked=!0,noSelect.nextSibling.classList.remove("unactive"),mouseSelect.nextSibling.classList.add("unactive"),useCtrl.nextSibling.classList.add("unactive"),toggleKey.disabled=!0,autoAudio.disabled=!0),"mouseSelect"===e.selectMode&&(mouseSelect.checked=!0,mouseSelect.nextSibling.classList.remove("unactive"),noSelect.nextSibling.classList.add("unactive"),useCtrl.nextSibling.classList.add("unactive"),toggleKey.disabled=!0,autoAudio.disabled=!1),"useCtrl"===e.selectMode&&(useCtrl.checked=!0,useCtrl.nextSibling.classList.remove("unactive"),noSelect.nextSibling.classList.add("unactive"),mouseSelect.nextSibling.classList.add("unactive"),toggleKey.disabled=!1,autoAudio.disabled=!1),0==e.showTips?(tips.classList.remove("unshow"),tips.classList.add("unshow"),isShowTips.checked=!1):(tips.classList.remove("unshow"),isShowTips.checked=!0),"side"===e.showPosition?(showPositionSide.checked=!0,showPositionSide.nextSibling.classList.remove("unactive"),showPositionNear.nextSibling.classList.add("unactive")):"near"===e.showPosition&&(showPositionNear.checked=!0,showPositionSide.nextSibling.classList.add("unactive"),showPositionNear.nextSibling.classList.remove("unactive")),"ctrl"===e.toggleKey?toggleKey.selectedIndex=0:"alt"===e.toggleKey?toggleKey.selectedIndex=1:"shift"===e.toggleKey&&(toggleKey.selectedIndex=2),!0===e.autoHide?(autoHide.checked=!0,autoHide.nextSibling.classList.remove("unactive"),showDuration.disabled=!1):(autoHide.checked=!1,autoHide.nextSibling.classList.add("unactive"),showDuration.disabled=!0),currentDuration.innerHTML=showDuration.value=e.showDuration}),linkQuery.addEventListener("click",function(e){var t=linkQuery.checked;linkQuery.nextSibling.classList.toggle("unactive"),chrome.storage.sync.set({linkQuery:t},function(){})}),useHttps.addEventListener("click",function(e){var t=useHttps.checked;useHttps.nextSibling.classList.toggle("unactive"),chrome.storage.sync.set({useHttps:t})}),isShowTips.addEventListener("click",function(e){1==isShowTips.checked?(tips.classList.remove("unshow"),chrome.storage.sync.set({showTips:!0},function(){})):(tips.classList.remove("unshow"),tips.classList.add("unshow"),chrome.storage.sync.set({showTips:!1},function(){}))}),autoAudio.addEventListener("click",function(e){var t=autoAudio.checked;t?autoAudio.nextSibling.classList.remove("unactive"):autoAudio.nextSibling.classList.add("unactive"),chrome.storage.sync.set({autoAudio:t},function(){})}),defaultUk.addEventListener("click",function(e){defaultUk.nextSibling.classList.remove("unactive"),defaultUs.nextSibling.classList.add("unactive"),chrome.storage.sync.set({defaultVoice:1},function(){})}),defaultUs.addEventListener("click",function(e){defaultUs.nextSibling.classList.remove("unactive"),defaultUk.nextSibling.classList.add("unactive"),chrome.storage.sync.set({defaultVoice:2},function(){})}),noSelect.addEventListener("click",function(e){toggleKey.disabled=!0,autoAudio.disabled=!0,noSelect.nextSibling.classList.remove("unactive"),mouseSelect.nextSibling.classList.add("unactive"),useCtrl.nextSibling.classList.add("unactive"),chrome.storage.sync.set({selectMode:"noSelect"},function(){})}),mouseSelect.addEventListener("click",function(e){toggleKey.disabled=!0,autoAudio.disabled=!1,noSelect.nextSibling.classList.add("unactive"),mouseSelect.nextSibling.classList.remove("unactive"),useCtrl.nextSibling.classList.add("unactive"),chrome.storage.sync.set({selectMode:"mouseSelect"},function(){})}),useCtrl.addEventListener("click",function(e){toggleKey.disabled&&(toggleKey.disabled=!1),autoAudio.disabled=!1,noSelect.nextSibling.classList.add("unactive"),mouseSelect.nextSibling.classList.add("unactive"),useCtrl.nextSibling.classList.remove("unactive"),chrome.storage.sync.set({selectMode:"useCtrl"},function(){})}),showPositionSide.addEventListener("click",function(e){showPositionSide.nextSibling.classList.remove("unactive"),showPositionNear.nextSibling.classList.add("unactive"),chrome.storage.sync.set({showPosition:"side"},function(){})}),showPositionNear.addEventListener("click",function(e){showPositionSide.nextSibling.classList.add("unactive"),showPositionNear.nextSibling.classList.remove("unactive"),chrome.storage.sync.set({showPosition:"near"},function(){})}),autoHide.addEventListener("click",function(e){var t=autoHide.checked;t?(autoHide.nextSibling.classList.remove("unactive"),showDuration.disabled=!1):(autoHide.nextSibling.classList.add("unactive"),showDuration.disabled=!0),chrome.storage.sync.set({autoHide:t},function(){})}),showDuration.addEventListener("input",function(e){currentDuration.innerHTML=showDuration.value,chrome.storage.sync.set({showDuration:showDuration.value},function(){})}),toggleKey.onchange=function(e){chrome.storage.sync.set({toggleKey:this.value},function(){})};